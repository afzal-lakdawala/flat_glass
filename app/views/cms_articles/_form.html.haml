- url = create_user_account_cms_articles_path(@account.owner, @account.slug)
- if @cms_article.id
  - url = update_user_account_cms_article_path(@account.owner, @account.slug, @cms_article.slug)
.row
  .col-sm-12
    .panel.panel-default
      = form_for(@cms_article, url: url, html: {role: "form"}) do |f|
        .panel-heading{style: "background: #F2F2F2;"}
          .form-group= f.text_field :title, class: "form-control", placeholder: "File Name", autofocus: true 
        .panel-content{style: "padding: 10px;"}
          .form-group
            .row  
              .col-sm-6   
                #editor
                  #toolbar.wmd-toolbar
                  = f.text_area :description, id: "input", cols:"65", rows:"20",class: "form-control wmd-input", required: true,placeholder: "Write here", :onscroll => "scrolling('textarea')", :onkeyup => "scrolling('textarea')"
              .col-sm-6
                %br
                %br
                #preview.wmd-preview{:style => "height: 420px; overflow:auto;background: #e7cb94;"}  
          .form-group 
            - if !@cms_article.is_published
              = f.submit 'Save as Draft', class: "btn btn-default", id: "submit"
            = f.hidden_field :account_id, value: @account.id
            = f.submit "Publish", class: "btn btn-success", id: "submit"

:javascript
  $(document).ready(function() {    

    $.ajaxSetup({ 
      'beforeSend': function(xhr) {xhr.setRequestHeader("Accept", "text/javascript")} 
    });

    $("#highlightCode").click(function(){
      $.SyntaxHighlighter.init({
      'lineNumbers': false,
      'debug': true
      });
    });  

    $('textarea').inlineattach({
      uploadFieldName: 'file',
      downloadFieldName: 'filename',      
      urlText: "![file]({filename})",

      uploadUrl: '#{create_user_account_cms_images_path()}.json', 
      allowedTypes: [
        'image/jpeg',
        'image/png',
        'image/jpg'
      ],

      onUploadedFile: function(json) {
        error = json.error;
        $.each(error,function(index,msg) {        

          var err_msg = "";
          var img_url = msg[0].split("-->")[1];

          if (confirm(msg)) {
            err_msg = $("textarea").val().replace('![Uploading file...]()', "![file]("+img_url+")");
          }else {
            err_msg = $("textarea").val().replace('![Uploading file...]()', '');
          }
          $("textarea").val(err_msg);
          
        });
        
      },
      customErrorHandler: function() {return true; },
     

      customUploadHandler: function(file) {return true; },
      errorText: "Error uploading file",
      progressText: '![Uploading file...]()'

    });    

    new WMD("input", "toolbar", { preview: "preview" });
  });
  var scrolling = function(opt){
    if(opt=='textarea'){
      $("#preview").scrollTop($("#input").scrollTop());
    }else{
      
    }
  }
